<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/cyberpunk.css}" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-white">
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>Dashboard de Productos</h2>
            <small class="text-muted">Gesti칩n completa de inventario</small>
        </div>
        <div>
            <a th:href="@{/admin/usuarios}" class="btn btn-outline-light me-2">
                <i class="fas fa-users me-1"></i>Gestionar Usuarios
            </a>
            <form th:action="@{/logout}" method="post" class="d-inline">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit" class="btn btn-outline-danger">
                    <i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesi칩n
                </button>
            </form>
        </div>
    </div>

    <!-- Alertas -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Tarjetas de Resumen -->
    <div class="row mb-4">
        <div class="col-xl-2 col-md-4 mb-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Total Productos</h6>
                            <h3 th:text="${totalProductos}" class="mb-0">0</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-boxes fa-2x opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 mb-3">
            <div class="card bg-warning text-dark">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Stock Bajo</h6>
                            <h3 th:text="${stockBajo}" class="mb-0">0</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-exclamation-triangle fa-2x opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 mb-3">
            <div class="card bg-danger text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Stock Cr칤tico</h6>
                            <h3 th:text="${stockCritico}" class="mb-0">0</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-skull-crossbones fa-2x opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 mb-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Total Reservado</h6>
                            <h3 th:text="${totalReservado}" class="mb-0">0</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-hand-holding fa-2x opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 mb-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Inventario Total</h6>
                            <h3 th:text="${inventarioTotal}" class="mb-0">0</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-warehouse fa-2x opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-2 col-md-4 mb-3">
            <div class="card bg-secondary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title">Disponible Real</h6>
                            <h3 th:text="${disponibleReal}" class="mb-0">0</h3>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-check-circle fa-2x opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtros y B칰squeda -->
    <div class="card bg-dark border-light mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <label for="searchInput" class="form-label">Buscar Producto</label>
                    <input type="text" class="form-control" id="searchInput" placeholder="Nombre del producto...">
                </div>
                <div class="col-md-6">
                    <label for="statusFilter" class="form-label">Filtrar por Estado</label>
                    <select class="form-select" id="statusFilter">
                        <option value="all">Todos los estados</option>
                        <option value="critico">游댮 Cr칤tico</option>
                        <option value="bajo">游리 Bajo</option>
                        <option value="normal">游릭 Normal</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de Productos -->
    <div class="card bg-dark border-light">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-list me-2"></i>Lista de Productos
                <small class="text-muted ms-2">(<span id="productCount" th:text="${productos.size()}">0</span> productos)</small>
            </h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-dark table-hover" id="productsTable">
                    <thead class="table-secondary">
                        <tr>
                            <th>Producto</th>
                            <th>Stock</th>
                            <th>Reservado</th>
                            <th>Real</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="p : ${productos}" class="product-row">
                            <td>
                                <strong th:text="${p.nombre}"></strong>
                                <br>
                                <small class="text-muted" th:text="${p.categoria}"></small>
                            </td>
                            <td th:text="${p.stock}"></td>
                            <td th:text="${p.stockReservado}"></td>
                            <td>
                                <strong th:text="${p.stock - p.stockReservado}"></strong>
                            </td>
                            <td>
                                    <th:block th:with="realStock=${p.stock - p.stockReservado}">
                                        <span th:if="${realStock <= 2}" class="badge bg-danger">
                                            <i class="fas fa-exclamation-circle me-1"></i>Cr칤tico
                                        </span>
                                        <span th:if="${realStock > 2 and realStock <= 5}" class="badge bg-warning text-dark">
                                            <i class="fas fa-exclamation-triangle me-1"></i>Bajo
                                        </span>
                                        <span th:if="${realStock > 5}" class="badge bg-success">
                                            <i class="fas fa-check-circle me-1"></i>Disponible
                                        </span>
                                    </th:block>
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <!-- Form de reposici칩n r치pida -->
                                    <form th:action="@{'/admin/productos/reponer/' + ${p.id}}" method="post" class="d-inline">
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                        <div class="input-group input-group-sm">
                                            <input type="number" class="form-control" name="cantidad" 
                                                   min="1" max="30" value="5" style="width: 70px;" 
                                                   title="Cantidad a reponer">
                                            <button type="submit" class="btn btn-success" 
                                                    th:title="'Reponer ' + ${p.nombre}">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript para Filtros -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');
    const productRows = document.querySelectorAll('.product-row');
    const productCount = document.getElementById('productCount');

    function filterProducts() {
        const searchTerm = searchInput.value.toLowerCase();
        const statusValue = statusFilter.value;
        let visibleCount = 0;

        productRows.forEach(row => {
            const productName = row.querySelector('strong').textContent.toLowerCase();
            const statusBadge = row.querySelector('.badge').textContent.toLowerCase();
            
            let statusMatch = true;
            if (statusValue === 'critico') statusMatch = statusBadge.includes('cr칤tico');
            else if (statusValue === 'bajo') statusMatch = statusBadge.includes('bajo');
            else if (statusValue === 'normal') statusMatch = statusBadge.includes('disponible');
            
            const nameMatch = productName.includes(searchTerm);
            
            if (nameMatch && statusMatch) {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        });
        
        productCount.textContent = visibleCount;
    }

    searchInput.addEventListener('input', filterProducts);
    statusFilter.addEventListener('change', filterProducts);
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>